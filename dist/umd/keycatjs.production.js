!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).keycatjs={})}(this,function(t){"use strict";var i=function(){var e=this;this.resolve=null,this.reject=null,this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})},c=function(){return(c=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)},s=function(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},l={eos:["telos","telos-testnet"]};function n(){}var u={eos:(n.prototype.isAcceptable=function(t){var n=t.name,e=t.nodes,r=t.urlOrigin;return console.log("about to validate isAcceptable",n,e,r),!!l.eos.find(function(t){return n===t})&&(e||function(t){var n=t.name,e=t.property,r=t.blockchain;throw new Error("Property '"+e+"' in 'blockchain' is required. This error occurred because '"+n+"' should follow initialization rules of '"+r+"' configuration.")}({name:n,property:"nodes",blockchain:"eos"}),console.log("EosValidator true"),!0)},n)},e=function(t,n){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,o,i=e.call(t),a=[];try{for(;(void 0===n||0<n--)&&!(r=i.next()).done;)a.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(o)throw o.error}}return a},r=function(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(e(arguments[n]));return t};function o(t,n,e){var r=new URL(t+n),o=new URLSearchParams;return o.set("blockchain",JSON.stringify(e.blockchain)),o.set("client",location.origin),e.account&&o.set("account",e.account),e.args&&o.set("payload",e.args),r.search=o.toString(),r.href}var a,f=(a=function(t,n){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function e(){this.constructor=t}a(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}),h=function(t){var n="function"==typeof Symbol&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")},p=(y.prototype.validateBlockchain=function(t){var n,e,r=t.name,o=t.plugin,i=Object.keys(u);try{for(var a=h(i),c=a.next();!c.done;c=a.next()){var s=c.value;if((new u[s]).isAcceptable(t))return}}catch(t){n={error:t}}finally{try{c&&!c.done&&(e=a.return)&&e.call(a)}finally{if(n)throw n.error}}if(!r||!o)throw new Error("Unknown configuration for 'blockchain' property.");console.warn("You are using custom name. We hope you understand what you are doing. We recommend using a preset name.")},y.prototype.spawnWindow=function(t,n){var e=this;if(void 0===n&&(n=!1),n&&!this._account)throw new Error('You must chain "account" method first. e.g) keycat.account(accountName).transact(...) ');var r=new i;this.win=function(t,n){if("page"===n)return window.open(t,"_blank");var e=["width=480","height=720","top="+(window.top.outerHeight/2+window.top.screenY-360),"left="+(window.top.outerWidth/2+window.top.screenX-240)].join(",");return window.open(t,"Keycat",e)}(t,this.config.ux);var o=setInterval(function(){e.win&&!e.win.closed||(clearInterval(o),r.reject("closed"))},500);return window.onmessage=function(t){var n=t.data;n.____keycat&&e.sendResponse(n,r)},r.promise},y.prototype.sendResponse=function(t,n){var e,r,o=t.type,i=t.payload;"close"===o?n.reject("closed"):(e=i.data,(r=i.error)&&n.reject(r),e&&n.resolve(e)),this.win&&this.win.close(),this.win=null},y.prototype.makeUrlData=function(t){return{blockchain:function(n){var e,t,r=Object.keys(l);try{for(var o=s(r),i=o.next();!i.done;i=o.next()){var a=i.value;if(l[a].find(function(t){return t===n.name}))return c(c({},n),{plugin:a})}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(!n.plugin)throw new Error("Cannot find 'plugin' property for your custom 'blockchain' configuration.");return n}(this.config.blockchain),account:this._account,args:encodeURIComponent(function(t){for(var n=new Uint8Array(t.length),e=0;e<n.length;e++)n[e]=t.charCodeAt(e);return String.fromCharCode.apply(String,r(new Uint16Array(n.buffer)))}(btoa(function(t){for(var n=new Uint16Array(t.length),e=0;e<n.length;e++)n[e]=t.charCodeAt(e);return String.fromCharCode.apply(String,r(new Uint8Array(n.buffer)))}(JSON.stringify(t)))))}},Object.defineProperty(y.prototype,"keycatOrigin",{get:function(){console.log("getting keycatOrigin, this.config is: ",this.config);var t,n=this.config.blockchain,e=n.origin,r=n.name;if("telos"===r)t="https://sign.telos.net";else{if("telos-testnet"!==r)throw new Error("Unknown network "+r);t="https://sign-dev.telos.net"}return new URL(e||t).origin},enumerable:!1,configurable:!0}),y.prototype.account=function(t){return this._account=t,this},y.prototype.signin=function(){var t=o(this.keycatOrigin,"/signin",this.makeUrlData());return this.spawnWindow(t)},y.prototype.transact=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=o(this.keycatOrigin,"/transact",this.makeUrlData(t));return this.spawnWindow(e,!0)},y.prototype.signArbitraryData=function(t){var n=o(this.keycatOrigin,"/sign-arbitrary-data",this.makeUrlData([t]));return this.spawnWindow(n,!0)},y.prototype.signTransaction=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=o(this.keycatOrigin,"/sign-transaction",this.makeUrlData(t));return this.spawnWindow(e,!0)},y);function y(t){this.config=t,this.sign=this.signTransaction,console.log("in Keycat constructor and config: ",t),this.validateBlockchain(t.blockchain),this._account=t.account}var d,g=(f(w,d=p),w);function w(t,n){return d.call(this,{blockchain:{name:"telos",origin:n,nodes:t}})||this}var v,b=(f(m,v=p),m);function m(t,n){return v.call(this,{blockchain:{name:"telos-testnet",origin:n,nodes:t}})||this}p.Telos=g,p.TelosTestnet=b,t.Keycat=p,Object.defineProperty(t,"__esModule",{value:!0})});